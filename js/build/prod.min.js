(function(){var a,b,c,d,e,f,g,h,i,j,k;i={appApiKey:"xTQmJlbMSj6FTOPSlhTmWn4W25qB9ySQ",absoluteCenter:L.latLng(50.45015381283251,30.52342593669891),absoluteRadius:15e3,url:{cursesUrl:"http://hskll-topin212.c9users.io/ajax/current",banksUrl:"http://hskll-topin212.c9users.io/ajax/banks",rgcUrl:"http://coop-labs-topin212.c9users.io/ajax/gc"},keyEvents:{rightClick:"contextmenu",leftClick:"click",keyUp:"keyup",keyEnter:13},userCoords:{defaultRadius:1500},colors:{userPointColor:"#170CF0",fieldColor:"#5AE069"},nearby:{limit:3},userMarker:{size:[42,42],image:"images/userIcon2.png"},start:{lat:50.45466,lon:30.5238}},f=L.Control.extend({options:{position:"topright"},onAdd:function(a){var b;return b=L.DomUtil.create("div","textfield"),$(b).html($(".personal-controls").html()),$(".personal-controls").hide(),b}}),L.Map=L.Map.extend({openPopup:function(a){return this._popup=a,this.addLayer(a).fire("popupopen",{popup:this._popup})}}),$(document).ready(function(){var l,m,n,o,p;return o=L.map("map",{zoomControl:!1,attributionControl:!1}).setView([i.start.lat,i.start.lon],15),L.Icon.Default.imagePath="images",p=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"GeoCurr project by Undefined Behavior"}),m=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"GeoCurr project by Undefined Behavior"}),n=L.control.layers({"Карта":p,"Супутник":m},null,{position:"bottomleft"}),o.addControl(n),console.log(n),o.addLayer(p),$(".leaflet-control-layers").css("margin-bottom","50px").hide(),l={lcKey:"allBanks",map:o},l.map.lastRoute=null,l.map.clearLastRoute=function(){return null!=this.lastRoute&&this.removeLayer(this.lastRoute),this.lastRoute=null,this},o.on("click",function(){var a,b,c,d;d=$(".leaflet-popup-close-button");for(c in d){a=d[c];try{a.click()}catch(e){b=e}}}),l.field=new c(l),l.userCoords=new j(l),l.markersStorage=new e(l),l.banksTempStorage=new a(l),l.userInput=new k(l),l.talker=new h(l),l.funcPanel=new d(l),l.entry=new b(l),l.builder=new g(l),l.map.addControl(new f),l.userCoords.set(i.start.lat,i.start.lon),l.map.setView(l.userCoords.get(),15),l.field.setField().addToMap(),$("#btn_search").on("click",l.entry.getEntryCallback())}),k=function(){function a(a){this.scope=a}return a.prototype.curr=null,a.prototype.buyOrSell=null,a.prototype.scope=null,a.prototype.getValuesFromIndex=function(){this.curr=$("input:radio[name=curr_start]:checked").val(),this.buyOrSell=$("input:radio[name=buy_sell_start]:checked").val()},a.prototype.getValuesFromControl=function(){this.curr=$("input:radio[name=curr_main]:checked").val(),this.buyOrSell=$("input:radio[name=buy_sell_main]:checked").val()},a.prototype.putValuesIntoControl=function(){$("input:radio[name=buy_sell_main]").filter("[value="+this.buyOrSell+"]").prop("checked",!0),$("input:radio[name=curr_main]").filter("[value="+this.curr+"]").prop("checked",!0)},a.prototype.implementInto=function(a){a.setUiHandler(this)},a.prototype.getCurr=function(){return this.curr},a.prototype.getSB=function(){return this.buyOrSell},a}(),j=function(){function a(a){this.lat=null,this.lon=null,this.rad=null,this.accuracy=null,this.scope=a}return a.prototype.lat=null,a.prototype.lon=null,a.prototype.rad=null,a.prototype.accuracy=null,a.scope=null,a.prototype.getLatLng=function(){return L.latLng(this.lat,this.lon)},a.prototype.get=function(){return[this.lat,this.lon]},a.prototype.set=function(a,b){return this.lat=a,this.lon=b,this},a.prototype.setRad=function(a){this.rad=a},a.prototype.getRad=function(){return this.rad},a.prototype.setAc=function(a){this.accuracy=a},a.prototype.getAc=function(){return this.accuracy},a.prototype.getZoom=function(){switch(!1){case!(this.rad<=1e3):return 15;case!(this.rad<=2e3&&this.rad>=1e3):return 14;case!(this.rad<=3e3&&this.rad>=2e3):return 13;default:return null}},a}(),h=function(){function a(a){this.scope=a}return a.prototype.scope=null,a.prototype.reversalGC=function(a){var b,c;return b=this.scope,c=function(c){var d,e,f;return f=b.funcPanel.getData().radius,e=b.funcPanel.getData().address,d=function(){3!==a&&b.map.setView(b.userCoords.get(),b.userCoords.getZoom()),b.markersStorage.removeMarkersFromMap(),b.markersStorage.clear(),b.markersStorage.renderMarkers(),b.field.update()},f.length>0&&(b.userCoords.setRad(f),!new RegExp("^-?[0-9]+$").test(f))?alert("wrong radius"):0===e.length?void d():e.length<2?alert("slishkom korotkiy adres"):($.ajax({url:i.url.rgcUrl,type:"GET",dataType:"JSON",data:{apiKey:i.appApiKey,adress:e,special:a},success:function(a){return i.absoluteCenter.distanceTo(L.latLng(a.lat,a.lon))>i.absoluteRadius?void alert("Too far from Kyiv!"):(b.userCoords.set(a.lat,a.lon),b.field.update(),void d())}}),!1)}},a}(),g=function(){function a(a){this.scope=a}return a.prototype.marker=null,a.prototype.currentCurrency=null,a.prototype.buyOrSellWord=null,a.prototype.buyOrSell=null,a.prototype.buyOrSellWordAction=null,a.prototype.amount=null,a.prototype.pedestrianOrCarWord=null,a.prototype.update=function(a){var b;return b=this.scope.funcPanel.getData().BOS,this.marker=a,this.currentCurrency=this.scope.funcPanel.getData().curr,this.buyOrSell=b,this.buyOrSellWord="sell"===b?"продаж":"купівля",this.buyOrSellWordAction="sell"===b?"Заплачу":"Отримаю",this.amount=this.scope.funcPanel.getData().amount,this.pedestrianOrCarWord="pedestrian"===this.scope.funcPanel.getData().POC?"пішки":"автівкою",this},a.prototype.top3Build=function(){return"<div class='tr not_header'> <div class='cell'><b>"+this.marker.data.bankName+"</b></div> <div class='cell'>"+this.marker.data[this.buyOrSell][this.currentCurrency]+"</div> <div class='cell'>"+this.marker.data[this.buyOrSell][this.currentCurrency]*this.scope.funcPanel.getData().amount+"</div> <div class='cell'>"+this.marker.length+"</div> <div class='cell'>"+this.marker.time+"</div> </div>"},a.prototype.defaultBuild=function(){return"<div class='table'> <div class='row'> <strong class='bank-marker'> "+this.marker.data.bankName+"</strong> </div> <div class='row'> <div class='cell'></div> <div class='cell'><strong>"+this.buyOrSellWord+"</strong></div> <div class='cell'></div> </div> <div class='row'> <div class='cell'><strong>"+this.currentCurrency+"</strong></div> <div class='cell'>"+this.marker.data[this.buyOrSell][this.currentCurrency]+"</div> <div class='cell'></div> </div> <div class='row'> "+this.buyOrSellWordAction+" за "+this.amount+" "+this.currentCurrency+" - "+this.amount*this.marker.data[this.buyOrSell][this.currentCurrency]+" грн. </div> <div class='row'> Відстань до пункту обміну - "+this.marker.data.length+" м </div> <div class='row'> Витрачу на дорогу - "+Math.ceil(this.marker.data.time/60)+" хв "+this.pedestrianOrCarWord+" </div> <div class='row dif'> "+this.marker.data.bankAdress+" </div> </div>"},a}(),e=function(){function a(a){this.scope=a,this.map=a.map,this.data=[],this.bestOptionIcon=L.icon({iconUrl:"images/bestOption.png",iconSize:[42,42],iconAnchor:[21,41],popupAnchor:[0,-21],shadowUrl:"images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[14,40]})}return a.prototype.data=[],a.prototype.promises=[],a.prototype.uiHandler=null,a.prototype.bestOptionIcon=null,a.prototype.map=null,a.prototype.scope=null,a.prototype.renderMarkers=function(){var a;this.buildMarkers(),a=this,$.when.apply($,this.promises).done(function(){a.addMarkersToMap(),a.drawBestOptions()})},a.prototype.addMarkersToMap=function(){var a,b,c,d;this.sortData(),console.log(this.scope.funcPanel.getUserWishToSeeAllMarkers()),b=this.scope.funcPanel.getUserWishToSeeAllMarkers()===!0?this.data.length:2,d=this.data;for(a in d){if(c=d[a],a>b)break;void 0===c.data.buy.usd&&(c.data.buy.usd=0),void 0===c.data.buy.rub&&(c.data.buy.rub=0),void 0===c.data.buy.eur&&(c.data.buy.eur=0),void 0===c.data.sell.usd&&(c.data.sell.usd=0),void 0===c.data.sell.eur&&(c.data.sell.eur=0),void 0===c.data.sell.rub&&(c.data.sell.rub=0),c.bindPopup(this.scope.builder.update(c).defaultBuild()),c._popup.setLatLng(c.getLatLng()),c._popup.options.closeOnClick=!1,c._popup.options.autoClose=!1,this.map.addLayer(c),c.on("click",function(){var a;console.log("trying to pass the route");try{return null!=this._map.lastRoute&&this._map.removeLayer(this._map.lastRoute),this._map.lastRoute=L.Routing.line(this.data.route),this._map.addLayer(this._map.lastRoute)}catch(b){return a=b,console.log(a)}}),console.log(a)}},a.prototype.removeMarkersFromMap=function(){var a;for(a in this.data)this.scope.map.removeLayer(this.data[a])},a.prototype.buildMarkers=function(){var a,b,c,d,e,f,g,h;b=this.scope.banksTempStorage.getData(),a=this.scope.banksTempStorage.curses.getCurses(),h=this.scope.userCoords;for(c in b)f=b[c],void 0!==a[f.bank]&&(d=h.getLatLng().distanceTo(L.latLng(f.latitude,f.longitude)))<h.rad&&(e=L.marker([f.latitude,f.longitude]),g=L.Routing.osrm({serviceUrl:function(a){return console.log(a.scope.funcPanel.getData().POC),"car"===a.scope.funcPanel.getData().POC?"http://osrm-car-prokopenko.c9users.io:8081/viaroute":"http://osrm-prokopenko.c9users.io:8081/viaroute"}(this)}),e.data={bankName:f.bank,bankAdress:f.adress,buy:{usd:a[f.bank].Buy.usd,rub:a[f.bank].Buy.rub,eur:a[f.bank].Buy.eur},sell:{usd:a[f.bank].Sell.usd,rub:a[f.bank].Sell.rub,eur:a[f.bank].Sell.eur},lat:f.latitude,lon:f.longitude,length:null,time:null,router:null},this.promises.push(function(){var a,b;return a=$.Deferred(),b=this,g.route([{latLng:h.getLatLng()},{latLng:L.latLng(f.latitude,f.longitude)}],function(c,d){null!=d?(this.data.route=d[0],this.data.length=d[0].summary.totalDistance,this.data.time=d[0].summary.totalTime):console.log(c),b.data.push(this),a.resolve()},e,{geometryOnly:!0}),a.promise()}.call(this)));return console.log("finished")},a.prototype.clear=function(){$(".nearby-bank-list").html(""),this.data=[],this.promises=[]},a.prototype.calculateRoutes=function(){var a;for(a in this.data)this.data[a].data.length=this.data[a].data.router._routes[0].totalDistance,this.data[a].data.time=this.data[a].data.router._routes[0].totalTime},a.prototype.setUiHandler=function(a){this.uiHandler=a},a.prototype.sortData=function(){var a,b,c,d;switch(d=this.scope.funcPanel.getData().option,c=this.scope.funcPanel.getData().curr,a=this.scope.funcPanel.getData().BOS,b=this.scope.funcPanel.getData().amount,d){case"time":return this.data.sort(function(a,b){return a.data.time-b.data.time});case"money":return this.data.sort(function(b,d){return"buy"===a?b.data[a][c]-d.data[a][c]:b.data[a][c]-d.data[a][c]});case"buy"===a:return this.data.sort(function(d,e){var f,g;return f=d.data[a][c]*b/d.data.time,g=e.data[a][c]*b/e.data.time,g-f});case"sell"===a:return function(b){var d;b.data.sort(function(b,d){return b.data[a][c]-d.data[a][c]});for(d in b.data)b.data[d].magic[0]=d;b.data.sort(function(a,b){return a.data.time-b.data.time});for(d in b.data)b.data[d].magic[1]=d;b.data.sort(function(a,b){return a.data.magic[0]+a.data.magic[1]-(b.data.magic[0]+b.data.magic[1])})}(this)}},a.prototype.drawBestOptions=function(){var a,b,c,d,e,f,g;for(console.log(this.data),f=this.scope.funcPanel.getData().markersLimiterToggle,d="sell"===this.scope.funcPanel.getData().BOS?"продаж":"купівля",e="продаж"===d?"заплачу":"отримаю",g="car"===this.scope.funcPanel.getData().POC?"авто":"пішки",$(".top3_out").empty(),$(".top3_out").append("<div class=  'tr'> <div class='cell'><b></b></div> <div class='cell'>"+d+"</div> <div class='cell'>"+e+" </div> <div class='cell'>відстань, м</div> <div class='cell'>час ("+g+"), хв</div> </div>"),a=this.data,b=c=0;3>c;b=++c)this.data[b].setIcon(this.bestOptionIcon),$(".top3_out").append("<div data-id='"+b+"' class='tr not_header top_bank'> <div class='cell'><b>"+this.data[b].data.bankName+"</b></div> <div class='cell'>"+this.data[b].data[this.scope.funcPanel.getData().BOS][this.scope.funcPanel.getData().curr]+"</div> <div class='cell'>"+this.data[b].data[this.scope.funcPanel.getData().BOS][this.scope.funcPanel.getData().curr]*this.scope.funcPanel.getData().amount+"</div> <div class='cell'>"+this.data[b].data.length+"</div> <div class='cell'>"+Math.ceil(this.data[b].data.time/60)+"</div> </div>");$("div.not_header").hover(function(){return a[$(this).attr("data-id")].openPopup()},function(){return a[$(this).attr("data-id")].closePopup()})},a}(),d=function(){function a(a){this.scope=a,this.init()}return a.prototype.scope=null,a.prototype.data={GOR:null,BOS:null,address:null,radius:null,option:null,amount:null,curr:null,markersLimiterToggle:null,POC:null},a.prototype.getData=function(){return this.data},a.prototype.init=function(){var a;a=this,this.clickRequests(),$("#address_main").val(""),$(".flip_arrow").on("click",this.manipulateArrow),$("#btn_address").on("click",this.manipulateAddressPanel),$("#btn_filters").on("click",this.manipulateFiltersPanel),$("input:radio[name=geolocOrAddress]").on("change",this.manipulateGeoRadioButton),$(".about_header").on("click",this.manipulateAboutNavButton),$(".contact_header").on("click",this.manipulateContactNavButton),$(".main_header").on("click",this.manipulateMainNavButton),$("#pedestrian, #car").on("click",this.manipulatePedestrianOrCarBtnGroup),$("#btn_send_message").on("click",this.manipulateSendMessageButton),$("#btn_send_again").on("click",this.manipulateSendMessageAgainButton),$(".main_input").on("change",function(){console.log("explode called"),a.getDataFromIndex(),a.explode()}),$(".side_input").on("change",function(){console.log("implode called"),a.implode(),a.scope.talker.reversalGC(3)()})},a.prototype.manipulateArrow=function(){$("#functional_panel").toggleClass("open"),$(".flip_arrow").attr("src","images/down.png"===$(".flip_arrow").attr("src")?"images/up.png":"images/down.png"),$("#functional_panel").slideToggle("slow")},a.prototype.manipulateAddressPanel=function(){$(".filters_panel").removeClass("active"),$("#functional_panel").hasClass("new_size")||$("#functional_panel").animate({height:"300px"}).addClass("new_size"),$(".address_panel").addClass("active")},a.prototype.manipulateFiltersPanel=function(){$(".address_panel").removeClass("active"),$("#functional_panel").hasClass("new_size")||$("#functional_panel").animate({height:"300px"}).addClass("new_size"),$(".filters_panel").addClass("active")},a.prototype.manipulateSearchButton=function(){$(".flip_arrow").attr("src","images/up.png"),$(".flip_arrow").off("click",this.manipulateArrow),$("#functional_panel").slideUp("slow").removeClass("open"),$("#functional_panel").hasClass("new_size")&&$("#functional_panel").animate({height:"-=150px"}).removeClass("new_size"),$(".side_panel").fadeIn("slow"),$(".left_side_panel").fadeIn("slow")},a.prototype.manipulateGeoRadioButton=function(){"addressMain"===$("input:radio[name=geolocOrAddress]:checked").val()?$("#address_main").prop("disabled",!1):$("#address_main").prop("disabled",!0)},a.prototype.manipulateAboutNavButton=function(){$(".flip_arrow").attr("src","images/down.png"),$(".main_header").removeClass("highlight"),$(".filters_panel").removeClass("active"),$(".address_panel").removeClass("active"),$(".functional_panel_header").css("display","none"),$(".contact_block").hasClass("active")&&$(".contact_block").removeClass("active"),$("#functional_panel").hasClass("full_screen")!==!0&&($("#functional_panel").hasClass("new_size")===!0?$("#functional_panel").animate({height:"100%"}).removeClass("new_size"):$("#functional_panel").animate({height:"100%"})),$("#functional_panel").slideDown().addClass("full_screen"),$(".about_block").addClass("active")},a.prototype.manipulateContactNavButton=function(){$(".feedback_form").show(),$(".form_sent").hide(),$(".form_failed").hide(),$(".flip_arrow").attr("src","images/down.png"),$(".main_header").removeClass("highlight"),$(".filters_panel").removeClass("active"),$(".address_panel").removeClass("active"),$(".functional_panel_header").css("display","none"),$(".about_block").hasClass("active")&&$(".about_block").removeClass("active"),$("#functional_panel").hasClass("full_screen")!==!0&&($("#functional_panel").hasClass("new_size")?$("#functional_panel").animate({height:"100%"}).removeClass("new_size"):$("#functional_panel").animate({height:"100%"})),$("#functional_panel").slideDown().addClass("full_screen"),$(".contact_block").addClass("active")},a.prototype.manipulateMainNavButton=function(){$(".flip_arrow").attr("src","images/down.png"),$(".about_block").removeClass("active"),$(".contact_block").removeClass("active"),"none"===$(".side_panel").css("display")?$(".functional_panel_header").css("display","block"):$("#functional_panel").slideUp(),$("#functional_panel").hasClass("full_screen")&&($("#functional_panel").removeClass("full_screen"),$("#functional_panel").css("height","150px"))},a.prototype.manipulatePedestrianOrCarBtnGroup=function(){$(".btn-pseudo-focus").removeClass("btn-pseudo-focus"),$(this).addClass("btn-pseudo-focus"),$._data($(".side_input")[0],"events").change[0].handler()},a.prototype.manipulateSendMessageButton=function(){$(".feedback_form").hide(),$(".form_sent").show()},a.prototype.manipulateSendMessageAgainButton=function(){$(".form_failed").hide(),$(".feedback_form").show()},a.prototype.pocChecker=function(){return function(a){return 1500>=a?function(){return $("#pedestrian").addClass("btn-pseudo-focus"),$("#car").removeClass("btn-pseudo-focus"),"pedestrian"}():function(){return $("#car").addClass("btn-pseudo-focus"),$("#pedestrian").removeClass("btn-pseudo-focus"),"car"}()}($("#radius_side").val())},a.prototype.getDataFromIndex=function(){var a;this.data.GOR=$("input:radio[name=geolocOrAddress]:checked").val(),this.data.address=$("#address_main").val(),this.data.radius=$("#radius_main").val(),this.data.BOS=$("input:radio[name=buyOrSellMain]:checked").val(),this.data.amount=""===(a=$("#amount_main").val())?1:a,this.data.curr=$("input:radio[name=currencyMain]:checked").val(),this.data.option=$("input:radio[name=bestOptionMain]:checked").val(),this.data.markersLimiterToggle=!1,this.data.POC=this.pocChecker()},a.prototype.getDataFromSide=function(){var a;this.data.address=$("#address_side").val(),this.data.radius=$("#radius_side").val(),this.data.BOS=$("input:radio[name=buyOrSellSide]:checked").val(),this.data.amount=""===(a=$("#amount_side").val())?1:a,this.data.curr=$("input:radio[name=currencySide]:checked").val(),this.data.option=$("input:radio[name=bestOptionSide]:checked").val(),this.data.markersLimiterToggle=null!=$("#showAllBanksOrNot:checked").val()?!0:!1,this.data.POC=$("button.btn-pseudo-focus").attr("id")},a.prototype.implode=function(){return this.getDataFromSide(),this.scope.map.clearLastRoute(),this.scope.userCoords.setRad(this.data.radius),console.log(this.data.POC),this},a.prototype.explode=function(){return this.scope.userCoords.setRad(this.data.radius),$("#address_side").val(this.data.address),$("#radius_side").val(this.data.radius),1===this.data.amount?$("#amount_side").val(""):$("#amount_side").val(this.data.amount),$("input:radio[name=currencySide]").filter("[value="+this.data.curr+"]").prop("checked",!0),$("input:radio[name=buyOrSellSide]").filter("[value="+this.data.BOS+"]").prop("checked",!0),$("input:radio[name=bestOptionSide]").filter("[value="+this.data.option+"]").prop("checked",!0),this},a.prototype.getUserPermission=function(){return console.log(this.data.GOR),"geolocMain"===this.data.GOR?!0:!1},a.prototype.clickRequests=function(){var a;a=this.scope,$("#btn_set_marker").on(i.keyEvents.leftClick,function(){return a.funcPanel.implode(),a.talker.reversalGC(0)().on(i.keyEvents.rightClick,function(){}),a.funcPanel.implode(),a.talker.reversalGC(1)()}),$("#address_side, #amount_side").on(i.keyEvents.keyUp,function(b){b.which===i.keyEvents.keyEnter&&(a.funcPanel.implode(),a.talker.reversalGC(0)())}),$("#map").on(i.keyEvents.rightClick,function(a){return!1})},a.prototype.getUserWishToSeeAllMarkers=function(){return this.data.markersLimiterToggle},a}(),c=function(){function a(a){this.field=null,this.user=null,this.scope=a,this.userIcon=L.icon({iconUrl:i.userMarker.image,iconSize:i.userMarker.size,iconAnchor:[21,40],popupAnchor:[0,-21],shadowUrl:"images/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[14,40]})}return a.prototype.field=null,a.prototype.user=null,a.prototype.userIcon=null,a.prototype.userMarker=null,a.prototype.scope=null,a.prototype.update=function(){return this.updateLatLng(),this.updateRadius(),this},a.prototype.updateLatLng=function(){this.setLatLng(this.scope.userCoords.getLatLng())},a.prototype.updateRadius=function(){this.setRadius(this.scope.userCoords.getRad())},a.prototype.setField=function(){var a;return a=this.scope,this.field=L.circle(this.scope.userCoords.getLatLng(),this.scope.userCoords.getRad(),{color:i.colors.fieldColor}),this.user=L.circle(this.field.getLatLng(),this.scope.userCoords.getAc(),{color:i.colors.userPointColor,opacity:.3}),this.userMarker=L.marker(this.scope.userCoords.getLatLng(),{icon:this.userIcon,draggable:!0}),this.userMarker.bindPopup("Ви тут!"),this.userMarker.on("click",function(){return console.log(this)}),this.userMarker.on("dragend",function(b){var c;try{return c=b.target.getLatLng(),a.map.clearLastRoute(),a.userCoords.set(c.lat,c.lng),a.field.update(),a.map.setView(a.userCoords.get(),a.userCoords.getZoom()),a.markersStorage.removeMarkersFromMap(),a.markersStorage.clear(),a.field.update(),$.when(a.banksTempStorage.init()).done(function(){return a.markersStorage.renderMarkers()})}catch(d){b=d}}),this},a.prototype.setLatLng=function(a){return this.field.setLatLng(a),this.user.setLatLng(a),this.user.setRadius(0),this.userMarker.setLatLng(a),this},a.prototype.setRadius=function(a){return this.field.setRadius(a),this},a.prototype.addToMap=function(){this.scope.map.addLayer(this.field),this.scope.map.addLayer(this.user),this.scope.map.addLayer(this.userMarker),this.field.bringToBack()},a}(),b=function(){function a(a){this.scope=a}return a.prototype.scope=null,a.prototype.malevolentAgentOfVoid=!0,a.prototype.getEntryCallback=function(){var a,b;return b=this,a=function(){b.scope.funcPanel.getDataFromIndex(),$(".leaflet-control-layers").show(),b.scope.funcPanel.explode(),b.scope.funcPanel.manipulateSearchButton(),b.scope.funcPanel.getUserPermission()===!0?b.getMarkerByGeoloc():b.getMarkerByAddress()}},a.prototype.getAllowCallback=function(){var a,b,c;return a=this.scope,c=this,b=function(b){c.malevolentAgentOfVoid=!1,a.userCoords.setAc(b.coords.accuracy),a.userCoords.set(b.coords.latitude,b.coords.longitude),a.map.setView(a.userCoords.get(),a.userCoords.getZoom()),a.field.update(),$.when(a.banksTempStorage.init()).done(function(){return a.markersStorage.renderMarkers()})}},a.prototype.getDisallowCallback=function(){var a,b,c;return a=this.scope,c=this,b=function(b){c.malevolentAgentOfVoid=!1,a.field.update(),$.when(a.banksTempStorage.init()).done(function(){return a.markersStorage.renderMarkers()})}},a.prototype.getMarkerByGeoloc=function(){var a;a=this,setTimeout(function(){return a.malevolentAgentOfVoid===!0?a.getDisallowCallback()():void 0},7e3),navigator.geolocation.getCurrentPosition(this.getAllowCallback(),this.getDisallowCallback())},a.prototype.getMarkerByAddress=function(){var a;return a=this.scope,$.when(a.banksTempStorage.init()).done(function(){return a.markersStorage.renderMarkers()}),this.scope.talker.reversalGC(0)()},a}(),a=function(){function a(a){this.scope=a,this.localKey=this.scope.lcKey}return a.prototype.data=null,a.prototype.localKey=null,a.prototype.scope=null,a.prototype.init=function(){var a,b;return b=this,a=$.Deferred(),$.when(this.curses.callServerForCurses()).done(function(){return b.digOut(),null===b.data&&(b.callServerForData(),b.bury()),a.resolve()}),a.promise()},a.prototype.callServerForData=function(){var a,b;a=$.ajax({type:"GET",data:{apiKey:i.appApiKey},url:i.url.banksUrl,async:!1}).responseText;try{this.setData(JSON.parse(a))}catch(c){b=c,console.log("Server says"+a)}},a.prototype.digOut=function(){this.data=JSON.parse(localStorage.getItem(this.localKey))},a.prototype.bury=function(){localStorage.setItem(this.localKey,JSON.stringify(this.data))},a.prototype.graveBurn=function(){localStorage.clear()},a.prototype.isEmpty=function(){return null===this.data?!0:!1},a.prototype.getData=function(){return this.data},a.prototype.setData=function(a){this.data=a},a.prototype.clean=function(){this.data=null},a.prototype.curses={cursesItself:null,lastUpdated:null,callServerForCurses:function(){var a;return a=this,$.ajax({type:"GET",data:{apiKey:i.appApiKey},url:i.url.cursesUrl,success:function(b){var c;try{a.setCurses(b.curses),a.setLastUpdated(b.lastUpdated)}catch(d){c=d,console.log("Server says "+b)}}})},setLastUpdated:function(a){this.lastUpdated=a},setCurses:function(a){this.cursesItself=a},getCurses:function(){return this.cursesItself},getLastUpdated:function(){return this.lastUpdated}},a}()}).call(this);